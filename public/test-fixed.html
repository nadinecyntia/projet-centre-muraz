<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="admin.title">Test Translation FIXED - Centre MURAZ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .language-selector { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß Test Translation FIXED</h1>
    
    <div class="test-section">
        <h2>1. Test de chargement des fichiers</h2>
        <div id="file-test">Chargement...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Test du TranslationManagerFixed</h2>
        <div id="manager-test">Chargement...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Test des traductions</h2>
        <div id="translation-test">Chargement...</div>
    </div>
    
    <div class="test-section">
        <h2>4. Test du s√©lecteur de langue</h2>
        <div id="selector-test">Chargement...</div>
        <div id="languageSelector" class="language-selector"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Test de changement de langue</h2>
        <button onclick="testLanguageChange()">Tester changement EN/FR</button>
        <div id="change-test">Cliquez sur le bouton</div>
    </div>

    <div class="test-section">
        <h2>6. Test des √©l√©ments traduits</h2>
        <p data-i18n="dashboard.title">Titre du dashboard</p>
        <p data-i18n="dashboard.subtitle">Sous-titre du dashboard</p>
        <p data-i18n="navigation.home">Accueil</p>
        <p data-i18n="navigation.analyses">Analyses</p>
        <p data-i18n="navigation.indices">Indices</p>
        <p data-i18n="navigation.admin">Administration</p>
    </div>

    <script>
        // Test 1: Chargement des fichiers
        async function testFileLoading() {
            const fileTest = document.getElementById('file-test');
            try {
                const response = await fetch('/translations/fr.json');
                if (response.ok) {
                    const data = await response.json();
                    fileTest.innerHTML = `<span class="success">‚úÖ Fichier fr.json charg√© (${Object.keys(data).length} sections)</span>`;
                } else {
                    fileTest.innerHTML = `<span class="error">‚ùå Erreur chargement fr.json: ${response.status}</span>`;
                }
            } catch (error) {
                fileTest.innerHTML = `<span class="error">‚ùå Erreur: ${error.message}</span>`;
            }
        }

        // Test 2: TranslationManagerFixed
        function testTranslationManager() {
            const managerTest = document.getElementById('manager-test');
            if (window.translationManager) {
                managerTest.innerHTML = `
                    <span class="success">‚úÖ TranslationManagerFixed trouv√©</span><br>
                    <span class="info">- Langue: ${window.translationManager.getCurrentLanguage()}</span><br>
                    <span class="info">- Charg√©: ${window.translationManager.isLoaded}</span><br>
                    <span class="info">- Traductions: ${Object.keys(window.translationManager.translations || {}).length} langues</span>
                `;
            } else {
                managerTest.innerHTML = `<span class="error">‚ùå TranslationManagerFixed non trouv√©</span>`;
            }
        }

        // Test 3: Traductions
        function testTranslations() {
            const translationTest = document.getElementById('translation-test');
            if (window.translationManager && window.translationManager.isLoaded) {
                const currentLang = window.translationManager.getCurrentLanguage();
                const translations = window.translationManager.translations[currentLang];
                if (translations) {
                    translationTest.innerHTML = `
                        <span class="success">‚úÖ Traductions charg√©es pour ${currentLang}</span><br>
                        <span class="info">- admin.title: "${window.translationManager.t('admin.title')}"</span><br>
                        <span class="info">- dashboard.title: "${window.translationManager.t('dashboard.title')}"</span><br>
                        <span class="info">- navigation.home: "${window.translationManager.t('navigation.home')}"</span>
                    `;
                } else {
                    translationTest.innerHTML = `<span class="error">‚ùå Aucune traduction pour ${currentLang}</span>`;
                }
            } else {
                translationTest.innerHTML = `<span class="error">‚ùå Traductions non charg√©es</span>`;
            }
        }

        // Test 4: S√©lecteur de langue
        function testLanguageSelector() {
            const selectorTest = document.getElementById('selector-test');
            const selectorDiv = document.getElementById('languageSelector');
            
            if (window.translationManager) {
                try {
                    const selector = window.translationManager.createLanguageSelector();
                    selectorDiv.appendChild(selector);
                    selectorTest.innerHTML = `<span class="success">‚úÖ S√©lecteur cr√©√©</span>`;
                    
                    // Ajouter l'√©couteur
                    const select = selector.querySelector('select');
                    if (select) {
                        select.addEventListener('change', (e) => {
                            console.log('Changement de langue:', e.target.value);
                            window.translationManager.changeLanguage(e.target.value).then(() => {
                                testTranslations();
                                // Re-tester les √©l√©ments traduits
                                setTimeout(() => {
                                    const elements = document.querySelectorAll('[data-i18n]');
                                    elements.forEach(el => {
                                        const key = el.getAttribute('data-i18n');
                                        const translation = window.translationManager.t(key);
                                        if (translation !== key) {
                                            el.textContent = translation;
                                        }
                                    });
                                }, 100);
                            });
                        });
                        selectorTest.innerHTML += `<br><span class="success">‚úÖ √âcouteur ajout√©</span>`;
                    }
                } catch (error) {
                    selectorTest.innerHTML = `<span class="error">‚ùå Erreur cr√©ation s√©lecteur: ${error.message}</span>`;
                }
            } else {
                selectorTest.innerHTML = `<span class="error">‚ùå TranslationManagerFixed non disponible</span>`;
            }
        }

        // Test 5: Changement de langue
        async function testLanguageChange() {
            const changeTest = document.getElementById('change-test');
            changeTest.innerHTML = '<span class="info">Test en cours...</span>';
            
            try {
                // Test vers EN
                await window.translationManager.changeLanguage('en');
                changeTest.innerHTML += '<br><span class="success">‚úÖ Changement vers EN r√©ussi</span>';
                
                // Attendre un peu
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Test vers FR
                await window.translationManager.changeLanguage('fr');
                changeTest.innerHTML += '<br><span class="success">‚úÖ Changement vers FR r√©ussi</span>';
                
                changeTest.innerHTML += '<br><span class="success">‚úÖ Test de changement termin√©</span>';
            } catch (error) {
                changeTest.innerHTML += `<br><span class="error">‚ùå Erreur: ${error.message}</span>`;
            }
        }

        // Lancer tous les tests
        async function runAllTests() {
            await testFileLoading();
            testTranslationManager();
            testTranslations();
            testLanguageSelector();
        }

        // Attendre que le DOM soit charg√©
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runAllTests);
        } else {
            runAllTests();
        }
    </script>
    
    <!-- Charger le script de traduction FIXED -->
    <script src="./js/translation-fixed.js"></script>
</body>
</html>
